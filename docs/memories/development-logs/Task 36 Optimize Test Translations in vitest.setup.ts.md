# Task 36 — Optimize Test Translations in vitest.setup.ts

- Task ID: 36
- Title: Optimize Test Translations in vitest.setup.ts
- Status: done
- Subtasks: All 6 subtasks completed successfully
- Date: 2025-11-20
- Author: basic-memory-specialist

## Implementation Summary
Refactored Vitest test setup to remove hardcoded translation objects and dynamically load the real translation JSON files from public/locales. Tests now use a single source of truth for i18n strings, improving accuracy and reducing maintenance.

## Key Changes
1. vitest.setup.ts — Complete refactor
   - Added Node.js `fs` and `path` imports for file reading in test setup
   - Implemented `flattenTranslations()` to convert nested JSON into dot-notation keys
   - Implemented `loadTranslations()` to read and parse translation files from `public/locales/en/`
   - Removed 73 hardcoded translation keys (previously lines ~34-107)
   - Now dynamically loads 90+ keys from actual `translation.json` files
   - Maintains existing i18next mock behavior, including pluralization and interpolation support

2. Test files updated
   - src/components/__tests__/CategorySelect.test.tsx — Updated 21 test assertions to use actual translated text instead of translation keys
   - src/components/__tests__/GamePlay.test.tsx — Updated 2 test assertions for the "No Winner" button
   - All existing tests (325) pass using the real translations

3. New tests added
   - src/components/__tests__/translation-loading.test.tsx
     * 5 focused tests to verify:
       - Translations load from actual JSON files
       - Interpolation works correctly
       - Nested keys are properly flattened
       - New translations (not present in old hardcoded version) are available
       - Pluralization works with loaded translations

4. Documentation updated
   - docs/TESTING.md — Added "Translation Files in Tests" section that explains:
     * How translations are dynamically loaded in vitest.setup.ts
     * Benefits of using a single source of truth
     * How to add/update translations for tests
     * Code examples and best practices
     * Translation file structure

## Technical Details
- Uses synchronous file reads (acceptable in test setup before tests run)
- Flattens nested JSON structure (e.g., `{ common: { loading: "..." } }` → `{ "common.loading": "..." }`)
- Loads only English translations (default language for tests)
- Throws a clear error if translation files cannot be loaded
- Compatible with existing i18next mock including pluralization (`_one`, `_other` suffixes) and interpolation (`{{param}}`)

## Quality Assurance
- Tests: 330 total (325 existing + 5 new) — all passing
- Lint: Clean (Biome)
- Typecheck: Clean (TypeScript)
- Build: Successful
- Complete-check: 100% pass

## Files Modified
- vitest.setup.ts (refactored)
- src/components/__tests__/CategorySelect.test.tsx (21 assertions updated)
- src/components/__tests__/GamePlay.test.tsx (2 assertions updated)
- docs/TESTING.md (documentation added)

## Files Created
- src/components/__tests__/translation-loading.test.tsx

## Benefits
- Single source of truth for translations in tests
- Eliminates duplicate translation maintenance
- Tests automatically reflect latest translation content
- Better test accuracy by using real translations
- Easier to add new translations — update JSON files and tests reflect changes

## Development Log / Notes
- Removed the brittle hardcoded translations in favor of reading from `public/locales/en/translation.json`.
- Ensured flattening preserves nested keys and supports interpolation/pluralization conventions used across the app.
- Verified tests that previously asserted keys now assert the resolved translated strings.
- Confirmed synchronous reads are only used in test setup and do not affect runtime code.

---
Generated by basic-memory-specialist for Task 36.
